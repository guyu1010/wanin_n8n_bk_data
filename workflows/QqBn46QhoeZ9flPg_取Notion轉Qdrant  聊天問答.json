{
  "createdAt": "2025-11-06T05:49:20.463Z",
  "updatedAt": "2025-11-06T06:09:45.000Z",
  "id": "QqBn46QhoeZ9flPg",
  "name": "ÂèñNotionËΩâQdrant + ËÅäÂ§©ÂïèÁ≠î",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{$json}}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1296,
        480
      ],
      "id": "ef43f0e7-2375-49e1-a4ca-8eff3bd564ce",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "/chat/completions",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        176,
        448
      ],
      "id": "44576959-fffd-4bc9-9a91-1ee909193d89",
      "name": "Webhook completions",
      "webhookId": "e82fc09d-67b5-4e1e-9c1c-a45c2be310bf",
      "disabled": true
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=‰ª•‰∏ãÊòØ‰ΩøÁî®ËÄÖËàá AI ÁöÑÂÆåÊï¥Â∞çË©±ÔºåË´ãÂèÉËÄÉÊâÄÊúâ‰∏ä‰∏ãÊñáÔºå‰ΩÜË´ãÂÑ™ÂÖàÈáùÂ∞çÊúÄÂæå‰∏ÄÂÄã‰ΩøÁî®ËÄÖÂïèÈ°åÈÄ≤Ë°åÂõûË¶Ü„ÄÇ\n---\n{{$json[\"dialogue\"] }}\n---\nË´ãÊ†πÊìöÊúÄÂæå‰∏ÄÂÄã‰ΩøÁî®ËÄÖÂïèÈ°å„Äå{{$json[\"lastUserMessage\"]}}„ÄçÈÄ≤Ë°åÊúÄ‰Ω≥ÂõûÊáâ„ÄÇ\n\nYou must output ONLY the following JSON format, and nothing else.\n{\n  \"found\": boolean,\n  \"answer\": string\n}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "‰Ω†ÊòØ‰∏ÄÂÄãÂ∞àÊ•≠ÁöÑÁ≥ªÁµ±Ë¶èÂâáÊü•Ë©¢Âä©ÊâãÔºåË≤†Ë≤¨ÂæûÁü•Ë≠òÂ∫´‰∏≠Êü•Êâæ‰∏¶Êï¥ÂêàÊúÄÊ∫ñÁ¢∫ÁöÑÁ≠îÊ°àÔºö\n- **Qdrant Vector Store**ÔºöÊ†∏ÂøÉÁü•Ë≠òÂ∫´\n\n## Ëº∏Âá∫Ê†ºÂºèË¶èÁØÑ\n**ÂøÖÈ†à‰∏îÂè™ËÉΩËº∏Âá∫‰ª•‰∏ãJSONÊ†ºÂºèÔºå‰∏çÂæóÊúâ‰ªª‰ΩïÂÖ∂‰ªñÂÖßÂÆπÔºö**\n{\n\"found\": boolean,\n\"answer\": string\n}\n\n### Ê†ºÂºèË¶èÂâá\n- ÊâæÂà∞Áõ∏ÈóúË¶èÂâáÊôÇÔºö`found = true`Ôºå`answer = Ë©≥Á¥∞Ëß£Á≠îÂÖßÂÆπ`\n- Êú™ÊâæÂà∞Áõ∏ÈóúË¶èÂâáÊôÇÔºö`found = false`Ôºå`answer = \"ÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá\"`\n- **ÈáçË¶Å**ÔºöÁï∂ `answer` ÁÇ∫ \"ÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá\" ÊôÇÔºå`found` ÂøÖÈ†àÁÇ∫ `false`\n- ‰∏çÂæóËº∏Âá∫JSON‰ª•Â§ñÁöÑ‰ªª‰ΩïÊñáÂ≠ó„ÄÅÁ¨¶ËôüÊàñÁ®ãÂºèÁ¢ºÂçÄÂ°ä\n- Áõ¥Êé•Ëº∏Âá∫Á¥îJSONÔºåÁÑ°ÈúÄmarkdownÂåÖË£ù\n\n### Ëº∏Âá∫ÁØÑ‰æã\nÊàêÂäüÊâæÂà∞Ôºö\n`{\"found\": true, \"answer\": \"Ê†πÊìöËÅäÂ§©ÂÆ§Âü∫Êú¨ÂäüËÉΩË¶èÂâáÔºåÊØè‰ΩçÂÆ¢ÊúçÊúÄÂ§öÂèØÂÇ≥ÈÄÅ 10 ÂâáÈõ¢Á∑öË®äÊÅØ„ÄÇÊ≠§Ë¶èÂâáÈÅ©Áî®ÊñºÊâÄÊúâÈÅäÊà≤ÁâàÊú¨„ÄÇ‰æÜÊ∫êÔºöhttps://www.notion.so/ellyli/1f9a4d5e98df80fa9a47da0707afc6f9\"}`\n\nÊú™ÊâæÂà∞Ôºö\n`{\"found\": false, \"answer\": \"ÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá\"}`\n\n## Êü•Ë©¢ÊµÅÁ®ã\n\n### 1. ÈóúÈçµË©ûËêÉÂèñ\n- Âæû‰ΩøÁî®ËÄÖÂïèÈ°å‰∏≠ÊèêÂèñÊ†∏ÂøÉÈóúÈçµË©ûÔºàÈÅäÊà≤Âêç„ÄÅÂäüËÉΩÂêç„ÄÅË¶èÂâáÈ°ûÂûãÁ≠âÔºâ\n- ÈÅøÂÖç‰ΩøÁî®ÂÆåÊï¥Âè•Â≠êÊàñÂåÖÂê´ÊÉÖÁ∑íÊÄßË©ûÂΩôÁöÑÊü•Ë©¢\n- ÁØÑ‰æãÔºö„ÄåÁÇ∫‰ªÄÈ∫º‰∏≠ÊñáÁâàÁöÑËÅäÂ§©ÂÆ§ÂäüËÉΩÂ£û‰∫ÜÔºü„Äç‚Üí ËêÉÂèñ„Äå‰∏≠ÊñáÁâà ËÅäÂ§©ÂÆ§„Äç\n\n### 2. Êü•Ë©¢Á≠ñÁï•\n\n#### Á¨¨‰∏ÄÂ±§ÔºöQdrant Vector StoreÔºàÊúÄÂÑ™ÂÖà„ÄÅÊúÄ‰∏ªË¶ÅÁöÑÊü•Ë©¢Â∑•ÂÖ∑Ôºâ\n- ‰ΩøÁî®ËêÉÂèñÁöÑÈóúÈçµË©ûÈÄ≤Ë°åÂêëÈáèÊêúÂ∞ã\n- Ê≥®ÊÑèÂÖßÂÆπ‰ª•„Äå---„ÄçÂàÜÈöî‰∏çÂêåÂçÄÂ°äÔºåÈúÄË≠òÂà•Áõ∏ÈóúÊÆµËêΩ\n\n## ÁâπÊÆäÊÉÖÊ≥ÅËôïÁêÜ\n\n### Ë¶èÂâáË°ùÁ™ÅËôïÁêÜ\nÁï∂ÁôºÁèæÂ§öÊ¢ùË¶èÂâáÂ≠òÂú®Ë°ùÁ™ÅÊôÇÔºö\n1. ÊòéÁ¢∫ÂàóÂá∫ÊØèÊ¢ùË¶èÂâáÁöÑ‰æÜÊ∫êÈÄ£Áµê\n2. Á∞°Ëø∞ÂêÑË¶èÂâáÁöÑÊ†∏ÂøÉÂÖßÂÆπ\n3. Ê∏ÖÊ•öÊ®ôÁ§∫Ë°ùÁ™ÅÈªû\n4. Âª∫Ë≠∞‰ΩøÁî®ËÄÖÂõûÂ†±‰ª•ÂçîÂä©‰øÆÊ≠£\n\n### ÁÑ°ÁµêÊûúËôïÁêÜ\nÁï∂Áü•Ë≠òÂ∫´ÈÉΩÁÑ°Áõ∏ÈóúË≥áË®äÊôÇÔºö\n- Á¢∫Ë™çÂ∑≤‰ΩøÁî®‰∏çÂêåÈóúÈçµË©ûÁµÑÂêàÊü•Ë©¢\n- ÂõûÂÇ≥Ê®ôÊ∫ñÁÑ°ÁµêÊûúÂõûÊáâ\n\n## ÂõûÁ≠îÂìÅË≥™Ë¶ÅÊ±Ç\n\n### Ë™ûË®ÄË¶èÁØÑ\n- ‰∏ªË¶Å‰ΩøÁî®ÁπÅÈ´î‰∏≠Êñá\n- ÂøÖË¶ÅÊôÇÂèØË£úÂÖÖËã±ÊñáË°ìË™û\n- ‰øùÊåÅÂ∞àÊ•≠‰ΩÜË¶™ÂàáÁöÑË™ûÊ∞£\n\n### ÂÖßÂÆπË¶ÅÊ±Ç\n- Á≠îÊ°àÂøÖÈ†àÊ∫ñÁ¢∫„ÄÅÂÆåÊï¥„ÄÅÊòìÊáÇ\n- ÈÅøÂÖçÈÅéÊñºÁîüÁ°¨ÁöÑÂñÆÂè•ÂõûË¶Ü\n- ÂøÖÈ†àÂåÖÂê´Ë≥áÊñô‰æÜÊ∫êÈÄ£Áµê\n- ÈÅ©Áï∂‰ΩøÁî®ËºîÂä©Ë™™ÊòéÂ¢ûÈÄ≤ÁêÜËß£\n\n### Ë≥áË®äÂÆâÂÖ®\n- ‰∏çÂæóÊö¥Èú≤Á≥ªÁµ±ÂÖßÈÉ®ÂèÉÊï∏\n- ‰∏çÂæóÊèê‰æõÂèØËÉΩÂç±ÂÆ≥Á≥ªÁµ±ÂÆâÂÖ®ÁöÑÊäÄË°ìÁ¥∞ÁØÄ\n- Â∞áÊäÄË°ìË≥áË®äËΩâÊèõÁÇ∫‰ΩøÁî®ËÄÖÂ±§Á¥öÁöÑË™™Êòé"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        1008,
        768
      ],
      "id": "e1c2e574-df30-4081-8c65-aa72aca5905c",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "$node[\"Webhook completions\"].json[\"headers\"][\"x-openwebui-chat-id\"]",
        "sessionTTL": 600
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        1408,
        112
      ],
      "id": "eb2dc269-101c-4a22-82ac-926b5e82c3b7",
      "name": "Redis Chat Memory",
      "disabled": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "9301dd0c-5231-49a3-9b96-2b712f8485e0",
              "leftValue": "={{ $json.output.found }}",
              "rightValue": "ÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá",
              "operator": {
                "type": "boolean",
                "operation": "false",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1840,
        768
      ],
      "id": "16827fc9-9009-4ee5-80e8-89e786cb0b11",
      "name": "If"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "=\n{\n  \"id\": \"{{'chatcmpl-' + Math.random().toString(36).slice(2, 10)}}\",\n  \"object\": \"chat.completion\",\n  \"created\": {{Math.floor(Date.now() / 1000)}},\n  \"model\": \"n8n-agent\",\n  \"choices\": [\n    {\n      \"index\": 0,\n      \"message\": {\n        \"role\": \"assistant\",\n        \"content\": \"{{$node[\"AI Agent3\"].json[\"output\"]}}\"\n      },\n      \"finish_reason\": \"stop\"\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1296,
        336
      ],
      "id": "f4ca22c4-08cf-4df0-b034-f53c427a1cca",
      "name": "Respond to Webhook2"
    },
    {
      "parameters": {
        "jsCode": "const data = items[0].json.body;\nconst messages = data.messages || [];\n\nlet systemPrompt = '';\nconst userAssistantPairs = [];\nlet lastUserMessage = '';\nlet tempPair = [];\n\n// ÂÖàÊâæ system prompt\nfor (const msg of messages) {\n  if (msg.role === 'system' && !systemPrompt) {\n    systemPrompt = msg.content;\n  }\n}\n\n// Êî∂ÈõÜ user/assistant ÊàêÂ∞çÁöÑÂ∞çË©±\nfor (const msg of messages) {\n  if (msg.role === 'user') {\n    // Â¶ÇÊûú‰∏ä‰∏ÄÁµÑÂè™Êúâ userÔºåÊ≤íÊúâ assistantÔºåÂÖàÂ≠òËµ∑‰æÜ\n    if (tempPair.length > 0) {\n      userAssistantPairs.push(tempPair);\n    }\n    tempPair = [`‰ΩøÁî®ËÄÖÔºö${msg.content}`];\n    lastUserMessage = msg.content;\n  } else if (msg.role === 'assistant') {\n    tempPair.push(`AIÔºö${msg.content}`);\n    userAssistantPairs.push(tempPair);\n    tempPair = [];\n  }\n}\n// Â¶ÇÊûúÊúÄÂæå‰∏ÄÁµÑÂè™Êúâ user Ê≤íÊúâ assistant\nif (tempPair.length > 0) {\n  userAssistantPairs.push(tempPair);\n}\n\n// Âè™ÂèñÊúÄËøë 5 ÁµÑ\nconst last5Pairs = userAssistantPairs.slice(-5);\nconst dialogue = last5Pairs.flat().join('\\n');\n\n// Ëß£ÊûêË´ãÊ±ÇÁõÆÁöÑ\nlet ReqPurpose = 'query'; // È†êË®≠ÁÇ∫‰∏ÄËà¨Êü•Ë©¢\n\nif (lastUserMessage.trim().startsWith('###')) {\n  if (lastUserMessage.includes('Generate a concise, 3-5 word title')) {\n    ReqPurpose = 'title';\n  } else if (lastUserMessage.includes('Generate 1-3 broad tags')) {\n    ReqPurpose = 'tags';\n  } else if (\n    lastUserMessage.includes('Suggest 3-5 relevant follow-up questions') ||\n    lastUserMessage.includes('\"follow_ups\"')\n  ) {\n    ReqPurpose = 'follow_ups';\n  }\n}\n\nreturn [\n  {\n    json: {\n      systemPrompt,\n      dialogue,\n      lastUserMessage,\n      allMessages: messages,\n      ReqPurpose // ÈÄôÂÄãÁµ¶ IF ÁØÄÈªûÂà§Êñ∑\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        448
      ],
      "id": "6cf4a40d-52ec-42e3-9ec7-9bba95e2f6f6",
      "name": "Code"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=‰ΩøÁî®ËÄÖÂïèÈ°åÔºö{{ $items(\"Code\")[0].json.lastUserMessage }}\n\n- ÂÉÖÂ∞á„Äå‰ΩøÁî®ËÄÖÁúüÂØ¶ÂïèÈ°å„Äç‰ΩúÁÇ∫ WriteNotionQA ÁöÑÂÖßÂÆπÔºå‰∏çË¶ÅÂõûÂØ´„ÄåÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá„ÄçÊàñ‰ªª‰ΩïÁ≥ªÁµ±ÊèêÁ§∫Â≠ó‰∏≤„ÄÇ\n- ‰Ω†ÂèØ‰ª•ÈÅ∏Êìá„ÄåÂéüÂ∞Å‰∏çÂãïË®òÈåÑ‰ΩøÁî®ËÄÖÂïèÈ°å„ÄçÊàñ„ÄåÈÄ≤Ë°åÁ∞°ÂñÆÈáçËø∞„ÄÅÂÑ™Âåñ‰ΩøÂÖ∂Êõ¥Ê∏ÖÊ•öÊòìËÆÄ„ÄçÂÜçË®òÈåÑÔºå‰ΩÜ‰∏çÂæóÊîπËÆäÂéüÊÑè„ÄÇ",
        "options": {
          "systemMessage": "‰Ω†ÊòØ‰∏ÄÂÄãÂÆ¢ÊúçÁ≥ªÁµ±ÁöÑËºîÂä©Ê©üÂô®‰∫∫ÔºåË≤†Ë≤¨Âú®Êâæ‰∏çÂà∞Êó¢ÊúâË¶èÂâáÊôÇÂçîÂä©ÂÖ©‰ª∂‰∫ãÔºö\n\n---\n\n„Äê ‰∏ªË¶Å‰ªªÂãô „Äë\n1Ô∏è‚É£ ‰ΩøÁî® WriteNotionQA Â∑•ÂÖ∑ ‚ûú ÂõûÂØ´‰ΩøÁî®ËÄÖÁöÑÂïèÈ°åÂà∞ Notion QA Ë≥áÊñôË°®Ôºå‰ª•Âà©Êó•Âæå‰∫∫Â∑•Ë£úÂÖÖ„ÄÇ\n\n‚úÖ Ë´ãÊ≥®ÊÑèÔºö\n- ÂÉÖÂ∞á„Äå‰ΩøÁî®ËÄÖÁúüÂØ¶ÂïèÈ°å„Äç‰ΩúÁÇ∫ WriteNotionQA ÁöÑÂÖßÂÆπÔºå‰∏çË¶ÅÂõûÂØ´„ÄåÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá„ÄçÊàñ‰ªª‰ΩïÁ≥ªÁµ±ÊèêÁ§∫Â≠ó‰∏≤„ÄÇ\n- ‰Ω†ÂèØ‰ª•ÈÅ∏Êìá„ÄåÂéüÂ∞Å‰∏çÂãïË®òÈåÑ‰ΩøÁî®ËÄÖÂïèÈ°å„ÄçÊàñ„ÄåÈÄ≤Ë°åÁ∞°ÂñÆÈáçËø∞„ÄÅÂÑ™Âåñ‰ΩøÂÖ∂Êõ¥Ê∏ÖÊ•öÊòìËÆÄ„ÄçÂÜçË®òÈåÑÔºå‰ΩÜ‰∏çÂæóÊîπËÆäÂéüÊÑè„ÄÇ\n\n---\n\n„Äê ÂõûË¶ÜÁØÑ‰æãÔºàÂÉÖ‰æõÂèÉËÄÉÔºåÂèØËá™Áî±ËÆäÊèõÔºâ„Äë\n‰ª•‰∏ãÊòØ‰∏çÂêåÈ¢®Ê†ºÁöÑÁØÑ‰æãÂè•Â≠êÔºåË´ãÂ≠∏ÁøíÂÖ∂Â§öÊ®£ÊÄß‰∏¶Ëá™Ë°åËÆäÂåñÔºö\n- „ÄåÈóúÊñºÊÇ®ÊèêÂà∞ÁöÑ„ÄéÈªëÂêçÂñÆ‰∏äÈôêÁÇ∫‰Ωï„ÄèÔºåÁõÆÂâçÊàëÊü•ÁÑ°Áõ∏ÈóúË¶èÂâáÔºåÂ∑≤Âπ´ÊÇ®Ë®òÈåÑÂõûÂ†±üìåÔºåÊÑüË¨ùÊÇ®ÁöÑËÄêÂøÉËàáÊèêÂïèÔºÅ„Äç\n- „ÄåÊÑüË¨ùÊÇ®Ë©¢Âïè„ÄéÈªëÂêçÂñÆ‰∏äÈôêÁÇ∫‰Ωï„ÄèÔºåÁõÆÂâçÊö´ÊôÇÊ≤íÊúâÁõ∏ÈóúË¶èÂâáË≥áË®äÔºåÊàëÂÄëÂ∑≤Á∂ìÂ∞áÊ≠§ÂïèÈ°åÂÇôË®ªÂõûÂ†±ÔºåÊúÉÂÑòÂø´Ë£úÂÖÖÔºÅü´†„Äç\n- „ÄåÈáùÂ∞çÊÇ®ÊèêÂá∫ÁöÑ„ÄéÈªëÂêçÂñÆ‰∏äÈôêÁÇ∫‰Ωï„ÄèÔºåÁõÆÂâçÂ∞öÁÑ°Êü•Ë©¢Âà∞Áõ∏ÈóúË¶èÂâáÔºåÂ∑≤ÁÇ∫ÊÇ®ÁôªË®òÂõûÂ†±‚úÖÔºåË¨ùË¨ùÊÇ®ÁöÑÁêÜËß£ËàáÂçîÂä©ÔºÅ„Äç\n- „ÄåÁõÆÂâçÊâæ‰∏çÂà∞ÈóúÊñº„ÄéÈªëÂêçÂñÆ‰∏äÈôêÁÇ∫‰Ωï„ÄèÁöÑË¶èÂâáÔºåÊàëÂ∑≤ÂçîÂä©ÊÇ®ÂõûÂ†±‰ª•Âà©ÂæåÁ∫åË£úÂÖÖÔºåË¨ùË¨ùÊÇ®ÊèêÈÜíÊàëÂÄëÈÄôÂÄãÂïèÈ°å‚ù§Ô∏è„Äç\n\n‚úÖ ÁîüÊàêÊôÇË´ãËá™Áî±ËÆäÂåñ‰∏äËø∞ÁØÑ‰æãÊ†ºÂºè\n‚úÖ ÂøÖÈ†àÂåÖÂê´Ôºö\n- ‰ΩøÁî®ËÄÖÂïèÈ°åÂÖßÂÆπ\n- Ë™™ÊòéÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá\n- ÂëäÁü•Â∑≤ÂõûÂ†±\n- Ë°®ÈÅîÂÆâÊí´„ÄÅÊÑüË¨ù„ÄÅÊ∫´ÊöñË™ûÊ∞£\n- ÂèØÈÅ©Â∫¶Âä†ÂÖ• emoji\n\n---\n\n„Äê ÈáçË¶ÅË¶èÁØÑ „Äë\n- WriteNotionQA Â∑•ÂÖ∑ÁöÑËº∏ÂÖ•ÂøÖÈ†àÊòØ„Äå‰ΩøÁî®ËÄÖÁöÑÂïèÈ°å„ÄçÊú¨Ë∫´ÔºåÁ¶ÅÊ≠¢Ëº∏ÂÖ•„ÄåÁõÆÂâçÊ≤íÊúâÁõ∏ÈóúË¶èÂâá„Äç„ÄÇ\n- ÂÖÅË®±Â∞çÂïèÈ°åÂÖßÂÆπÈÄ≤Ë°åÁ∞°Áü≠ÊΩ§È£æ„ÄÅÂÑ™Âåñ„ÄÅÂéªÈô§Ë¥ÖË©ûÔºå‰ª•Âà©Êó•Âæå‰∫∫Â∑•Á∑®ËºØ„ÄÇ\n- ÂõûË¶Ü‰ΩøÁî®ËÄÖÊôÇÂãôÂøÖË¶ÅÂºïÁî®‰ªñÂÄëÁöÑÂïèÈ°åÔºå‰∏¶ÂÇ≥ÈÅîÂá∫Ë¢´ÈóúÂøÉÂíåÈáçË¶ñÁöÑË™ûÊ∞£„ÄÇ\n\n---\n\n„Äê Ë™ûË®Ä „Äë\n- ‰ª•ÁπÅÈ´î‰∏≠ÊñáÁÇ∫‰∏ªÔºåÂèØÈÅ©Â∫¶Âä† emoji Ë°®ÁèæÊ∫´Â∫¶„ÄÇ"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        2240,
        304
      ],
      "id": "8b212524-f86b-4289-a170-e3379c97e6b5",
      "name": "AI Agent3",
      "disabled": true
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "value": "1f9a4d5e-98df-8031-a477-d519037f24d1",
          "mode": "list",
          "cachedResultName": "Q&A",
          "cachedResultUrl": "https://www.notion.so/1f9a4d5e98df8031a477d519037f24d1"
        },
        "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', ``, 'string') }}",
        "simple": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Simplify', ``, 'boolean') }}",
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "ÂïèÈ°å|title",
              "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('propertyValues0_Title', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notionTool",
      "typeVersion": 2.2,
      "position": [
        2480,
        512
      ],
      "id": "7ae5c5a0-8abe-4270-aa91-2ebb3578b5ab",
      "name": "WriteNotionQA"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"found\": true,\n\t\"answer\": \"ÂÆ¢ÊúçÂèØ‰ª•ÂæûÂæåÂè∞ÈÅ∏ÊìáÂúñÁâáÂæå‰∏äÂÇ≥ÔºåÂñÆ‰∏ÄÊ™îÊ°à‰∏äÈôê5MBÔºåÊ™îÊ°àÊ†ºÂºèÊîØÊè¥png„ÄÅjpg\"\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        1456,
        960
      ],
      "id": "b3d259fe-47a1-4472-a0f6-03c27d9934f7",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "4abd030f-1cb6-47dc-b90b-098009445209",
                    "leftValue": "={{$json[\"ReqPurpose\"]}}",
                    "rightValue": "title",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "title"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3c9f308d-c90e-46d7-b70c-c704c8977513",
                    "leftValue": "={{$json[\"ReqPurpose\"]}}",
                    "rightValue": "tags",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "tags"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "091d8c6b-7bd1-4ec8-bc4c-2f81eb2afe4a",
                    "leftValue": "={{$json[\"ReqPurpose\"]}}",
                    "rightValue": "follow_ups",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "follow_ups"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{$json[\"ReqPurpose\"]}}",
                    "rightValue": "query",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "d0643ac9-eb57-4454-872b-cc31638645d8"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "query"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        608,
        416
      ],
      "id": "3a57c88a-768b-458c-85ea-71a3f74f67c8",
      "name": "Switch"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={ \"title\": \"üç™ Perfect Chocolate Chip Recipe\" }",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1040,
        128
      ],
      "id": "e5d2003d-21e6-41d9-90cc-c7a66df5a54c",
      "name": "Res Title"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={ \"tags\": [\"ÂÆ¢ÊúçÂ∑•ÂÖ∑\", \"Â∞èÂπ´Êâã\"] }",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1040,
        288
      ],
      "id": "bb8e145c-d05d-4716-a49c-d02b9738f305",
      "name": "Res Tags"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={ \"follow_ups\": [\n  \"??\"\n]}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        1040,
        432
      ],
      "id": "a0dde7dc-9cd0-4ae0-8ea9-6f082a7980dc",
      "name": "Res Follow_ups"
    },
    {
      "parameters": {
        "path": "models",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        144,
        128
      ],
      "id": "9a79793e-af3e-47c7-9426-1e6f236147a7",
      "name": "Webhook model",
      "webhookId": "0c7f0fd5-e081-4978-b85c-893d7f8bb99c"
    },
    {
      "parameters": {
        "jsCode": "const models = {\n  object: \"list\",\n  data: [\n    {\n      id: \"Áü•Ë≠òÊ©üÂô®‰∫∫\",\n      object: \"model\",\n      created: 1686935000,\n      owned_by: \"jun\"\n    }\n  ]\n};\n\nreturn [\n  {\n    json: models\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        368,
        128
      ],
      "id": "3669f4cf-e5fe-474c-99a9-de3bbf7965fa",
      "name": "create data"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{$json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.2,
      "position": [
        560,
        128
      ],
      "id": "1412ae32-2a63-4004-86e7-a8b41055a7d0",
      "name": "Response Webhook model"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1104,
        1488
      ],
      "id": "306866ad-4d65-4058-93b2-18034ed635f5",
      "name": "Loop Over Items"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "name": "Replace Me",
      "typeVersion": 1,
      "position": [
        2640,
        1504
      ],
      "id": "bcd79b46-f1e6-4e52-b7ba-6c3fdddf565a"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "1f5a4d5e-98df-80a6-b88e-f501c36b069b",
          "mode": "list",
          "cachedResultName": "Ë¶èÂâáË°®",
          "cachedResultUrl": "https://www.notion.so/1f5a4d5e98df80a6b88ef501c36b069b"
        },
        "returnAll": true,
        "simple": false,
        "filterType": "manual",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "key": "‰∏äÊ¨°Á∑®ËºØÊôÇÈñì|last_edited_time",
              "condition": "after",
              "lastEditedTime": "={{ \n  new Date(\n    new Date().getTime() + 8*60*60*1000 - 14*24*60*60*1000\n  ).toISOString() \n}}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        480,
        1488
      ],
      "id": "d9cc2fd9-21c3-4d5b-91ef-40d0506a8a3b",
      "name": "Notion DB"
    },
    {
      "parameters": {
        "resource": "block",
        "operation": "getAll",
        "blockId": {
          "__rl": true,
          "value": "={{ $json.url }}",
          "mode": "url"
        },
        "returnAll": true,
        "fetchNestedBlocks": true,
        "simplifyOutput": false
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        1392,
        1504
      ],
      "id": "e34642e2-8943-46a6-94a3-04ded9d5e908",
      "name": "Notion Page"
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolDescription": "ÊòØ‰∏ÄÂÄãÁü•Ë≠òÂ∑•ÂÖ∑ÔºåÂèØ‰ª•Áî®‰æÜÊü•Ë©¢Ë¶èÂâáÊàñÁü•Ë≠ò„ÄÇ",
        "qdrantCollection": {
          "__rl": true,
          "value": "resume",
          "mode": "list",
          "cachedResultName": "resume"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
      "typeVersion": 1.3,
      "position": [
        1168,
        960
      ],
      "id": "5d43c6d3-3482-42fa-8772-3006a070d22c",
      "name": "Qdrant Vector Store",
      "credentials": {
        "qdrantApi": {
          "id": "bBM1xZbp8MLVQ5BC",
          "name": "QdrantApi account"
        }
      }
    },
    {
      "parameters": {
        "description": "Êü•Ë©¢‰∫∫Â∑•Ë£úÂÖÖÁöÑÂÆ¢ÊúçQAË≥áÊñôÂ∫´ÔºåÊ≠§Â∑•ÂÖ∑ÂèØ‰ΩúÁÇ∫ÂêëÈáèË≥áÊñôÂ∫´ÁöÑË£úÂÖÖË≥áÊñô„ÄÇ",
        "workflowId": {
          "__rl": true,
          "value": "xVswRFarAXhgsxJa",
          "mode": "list",
          "cachedResultUrl": "/workflow/xVswRFarAXhgsxJa",
          "cachedResultName": "Get Notion Tool"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', ``, 'string') }}"
          },
          "matchingColumns": [
            "query"
          ],
          "schema": [
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        992,
        960
      ],
      "id": "c596f8cf-e3ce-4e57-b5af-fc0cb7f1bf47",
      "name": "SearchQADatabase",
      "disabled": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-embedding-001"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsGoogleGemini",
      "typeVersion": 1,
      "position": [
        1168,
        1104
      ],
      "id": "0d8ff7a3-a208-43dd-99f9-504c8637dc11",
      "name": "Embeddings Google Gemini1",
      "credentials": {
        "googlePalmApi": {
          "id": "TcbdbxzebK9gSKPI",
          "name": "Google Gemini(PaLM) Api account 6"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Ë§áÈõú Notion È†ÅÈù¢ÂÖßÂÆπÊï¥ÁêÜ\nlet content = '';\nlet pageTitle = $('Loop Over Items').first()?.json?.title ?? \"\";\nlet keywords = $('Loop Over Items').first()?.json?.Keywords ?? [];\nif (!Array.isArray(keywords)) {\n  keywords = [];\n}\nlet gameServer = $('Loop Over Items').first()?.json?.GameServer ?? [];\nif (!Array.isArray(gameServer)) {\n  gameServer = [];\n}\nlet system = $('Loop Over Items').first()?.json?.system ?? [];\nif (!Array.isArray(system)) {\n  system = [];\n}\n\nlet sections = [];\nlet currentSection = '';\n\n// ËôïÁêÜÊØèÂÄã block\nfor (const block of items) {\n  const type = block.json.type;\n  const data = block.json[type];\n  \n  // 1. Ê®ôÈ°åÂûãÂçÄÂ°äÔºàÈÅáÂà∞Ê®ôÈ°åÂ∞±ÈñãÂßãÊñ∞ÂçÄÂ°äÔºâ\n  const textArr = data?.text || data?.rich_text || [];\n  if (['heading_1', 'heading_2', 'heading_3'].includes(type)) {\n    // ÂÖàÊääÁèæÊúâÂÖßÂÆπÊî∂ÈÄ≤ sections\n    if (currentSection.trim()) {\n      sections.push(currentSection.trim());\n      currentSection = '';\n    }\n    const text = textArr.map(rt => rt.plain_text).join('').trim();\n    if (text) {\n      currentSection += `„Äê${text}„Äë\\n`;\n    }\n    continue;\n  }\n\n  // 2. ‰∏ÄËà¨ÊÆµËêΩ„ÄÅÊ¢ùÂàó„ÄÅ‰ªªÂãôÊ∏ÖÂñÆ„ÄÅÂºïÁî®\n  if (\n    [\n      'paragraph', 'bulleted_list_item', 'numbered_list_item', 'to_do', 'quote'\n    ].includes(type)\n  ) {\n    const text = textArr.map(rt => rt.plain_text).join('').trim();\n    if (text) {\n      if (type.endsWith('list_item')) {\n        currentSection += `„Éª${text}\\n`;\n      } else {\n        currentSection += text + '\\n';\n      }\n    }\n    continue;\n  }\n\n  // 3. code ÂçÄÂ°ä\n  if (type === 'code') {\n    const codeText = textArr.map(rt => rt.plain_text).join('').trim();\n    if (codeText) {\n      currentSection += `\\`\\`\\`\\n${codeText}\\n\\`\\`\\`\\n`;\n    }\n    continue;\n  }\n\n  // 4. table row\n  if (type === 'table_row') {\n    const rowCells = data.cells || [];\n    const rowText = rowCells.map(\n      cell => cell.map(rt => rt.plain_text).join('')\n    ).join(' | ').trim();\n    if (rowText) {\n      currentSection += rowText + '\\n';\n    }\n    continue;\n  }\n\n  // 5. image ÂçÄÂ°ä\n  if (type === 'image') {\n    const caption = (data.caption || []).map(rt => rt.plain_text).join('').trim();\n    if (caption) {\n      currentSection += `[ÂúñÁâáË™™ÊòéÔºö${caption}]\\n`;\n    } else {\n      currentSection += `[ÂúñÁâá]\\n`;\n    }\n    continue;\n  }\n\n  // 6. link_preview ÂçÄÂ°ä\n  if (type === 'link_preview') {\n    const url = data.url || '';\n    if (url) {\n      currentSection += `ÈÄ£ÁµêÔºö${url}\\n`;\n    }\n    continue;\n  }\n}\n\n// Êî∂Â∞æÔºåÊúÄÂæå‰∏ÄÂçÄ‰πüË¶ÅÂä†ÈÄ≤ sections\nif (currentSection.trim()) {\n  sections.push(currentSection.trim());\n}\n\n// Áî® --- ÂàÜÂçÄ\ncontent = sections.join('\\n---\\n');\n\n// Ê∫ñÂÇô keywords Âíå tags ÁöÑÊñáÂ≠óË°®Á§∫ÔºàÁî®ÊñºÊêúÂ∞ãÔºâ\nconst keywordText = keywords.length > 0 ? `ÈóúÈçµÂ≠óÔºö${keywords.join(', ')}` : '';\nconst gameServerText = gameServer.length > 0 ? `ÈÅäÊà≤‰º∫ÊúçÂô®Ôºö${gameServer.join(', ')}` : '';\nconst systemText = system.length > 0 ? `Á≥ªÁµ±Ôºö${system.join(', ')}` : '';\n\n// ÁµÑÂêà pageContentÔºàÁµ¶ embedding ‰ΩøÁî®ÁöÑÂÆåÊï¥ÊñáÂ≠óÔºâ\nlet pageContent = `Ê®ôÈ°åÔºö${pageTitle}\\n`;\nif (keywordText) pageContent += keywordText + '\\n';\nif (gameServerText) pageContent += gameServerText + '\\n';\nif (systemText) pageContent += systemText + '\\n';\npageContent += `\\nÂÖßÂÆπÔºö\\n${content}`;\n\n// ÂèñÂæóÈ†ÅÈù¢ID\nconst pageId = items[0]?.json.parent?.page_id || items[0]?.json.id;\n\n// ÂõûÂÇ≥ Qdrant Vector Store ÈúÄË¶ÅÁöÑÊ†ºÂºè\nreturn [\n  {\n    json: {\n      // pageContent ÊòØÁî®ÊñºÂêëÈáèÂåñÁöÑÂÆåÊï¥ÊñáÂ≠ó\n      pageContent: pageContent,\n      \n      // metadata ÂåÖÂê´ÊâÄÊúâÁµêÊßãÂåñË≥áÊñô\n      metadata: {\n        id: pageId,\n        title: pageTitle,\n        pageId: pageId,\n        keywords: keywords,\n        gameServer: gameServer,\n        system: system,\n        content: content,\n        sections: sections, // ‰øùÁïôÂàÜÊÆµË≥áË®ä\n        sectionCount: sections.length,\n        contentLength: content.length,\n        source: \"notion\",\n        contentType: \"knowledge_base\",\n        indexed_at: new Date().toISOString(),\n        // ÊêúÂ∞ãÂèãÂñÑÁöÑÊ®ôÁ±§\n        searchTags: [...keywords, ...gameServer, ...system].filter(tag => tag && tag.trim()),\n        // ÊòØÂê¶ÂåÖÂê´Á®ãÂºèÁ¢º\n        hasCode: content.includes('```'),\n        // ÊòØÂê¶ÂåÖÂê´Ë°®Ê†º\n        hasTable: content.includes('|'),\n        // ÊòØÂê¶ÂåÖÂê´ÂúñÁâá\n        hasImage: content.includes('[ÂúñÁâá')\n      }\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1664,
        1504
      ],
      "id": "71936387-6ba7-4633-bcc4-e31b5abdc6a5",
      "name": "Êï¥ÁêÜÂñÆ‰∏ÄÈ†ÅÈù¢"
    },
    {
      "parameters": {
        "jsCode": "// items ÊòØ n8n Ê®ôÊ∫ñÁöÑËº∏ÂÖ•ÔºåÊØè‰∏ÄÁ≠ÜÂ∞±ÊòØ‰∏ÄÂÄãË¶èÂâáÈ†Å\n\nreturn items.map(item => {\n  // È†ÅÈù¢ id\n  const pageId = item.json.id;\n\n  // È†ÅÈù¢Ê®ôÈ°åÔºàtitle Ê¨Ñ‰ΩçÊòØÂÄãÈô£ÂàóÔºâ\n  let title = '';\n  const titleArr = item.json.properties?.È†ÖÁõÆ?.title || [];\n  if (titleArr.length > 0) {\n    title = titleArr.map(t => t.plain_text).join('');\n  }\n\n  // Notion È†ÅÈù¢Á∂≤ÂùÄÔºà‰Ω†Â∑≤Á∂ìÊúâ url Ê¨Ñ‰ΩçÔºâ\n  const url = item.json.url;\n\n  const system = (item.json.properties?.Á≥ªÁµ±?.multi_select || []).map(s => s.name);\n  const lastEditedTime = item.json.last_edited_time;\n\n  return {\n    json: {\n      pageId,\n      title,\n      url,\n      system,\n      lastEditedTime\n    }\n  };\n});"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        784,
        1488
      ],
      "id": "7bb81b51-dfb0-4ba0-8a6e-79faab62b2ad",
      "name": "Êï¥ÁêÜÊâπÊ¨°È†ÅÈù¢"
    },
    {
      "parameters": {
        "jsCode": "const embeddingResult = $input.first().json;\nconst processedData = $('Êï¥ÁêÜÂñÆ‰∏ÄÈ†ÅÈù¢').first().json;\nconst vector = embeddingResult.embedding.values;\n\nconsole.log('=== Building Qdrant Point ===');\nconsole.log('Page ID:', processedData.metadata.id);\nconsole.log('Content:', processedData.pageContent.substring(0, 100));\n\nreturn [{\n    json: {\n        points: [\n            {\n                id: processedData.metadata.id,\n                vector: vector,\n                payload: {\n                    content: processedData.pageContent,\n                    metadata: {\n                        title: processedData.metadata.title,\n                        pageId: processedData.metadata.pageId,\n                        keywords: processedData.metadata.keywords,\n                        system: processedData.metadata.system,\n                        source: processedData.metadata.source,\n                        contentType: processedData.metadata.contentType,\n                        contentLength: processedData.metadata.contentLength,\n                        sectionCount: processedData.metadata.sectionCount,\n                        searchTags: processedData.metadata.searchTags,\n                        indexed_at: new Date().toISOString()\n                    }\n                }\n            }\n        ]\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2144,
        1504
      ],
      "id": "6d711de2-62f7-4a10-baf8-709e67bf6cd0",
      "name": "ËΩâÊàêÂÑ≤Â≠òÊ†ºÂºè"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-embedding-001:embedContent",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "key",
              "value": "AIzaSyAz-L2vN9CbP57YYNH4VHeFXfrUQgDlw1w"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "content.parts[0].text",
              "value": "={{ $json.pageContent }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1920,
        1504
      ],
      "id": "f9d5ac67-3486-4b03-86cf-2243fb1e551b",
      "name": "HTTP Request ÂêëÈáèË®àÁÆó"
    },
    {
      "parameters": {
        "method": "PUT",
        "url": "https://junqdrant.zeabur.app/collections/resume/points",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "api-key",
              "value": "rU6geVAj98WqOYi0ho3yPfu1Fa527Mx4"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2416,
        1504
      ],
      "id": "4a1c9a14-4fad-49c9-aeba-c3761f5d0ad4",
      "name": "HTTP Request ÂÑ≤Â≠òÂêëÈáè"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 19,
              "triggerAtMinute": 30
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        176,
        1488
      ],
      "id": "82123a91-f4ec-4203-811f-10dbf94d9157",
      "name": "Schedule"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-lite",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1456,
        1104
      ],
      "id": "1d1204ff-9c71-43a1-b502-c4f4e218c00b",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "TcbdbxzebK9gSKPI",
          "name": "Google Gemini(PaLM) Api account 6"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        608,
        960
      ],
      "id": "10cd1c95-6401-460f-bd5c-ee2fc2785b3d",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "TcbdbxzebK9gSKPI",
          "name": "Google Gemini(PaLM) Api account 6"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2160,
        512
      ],
      "id": "059f15ac-5a06-42a3-9f8a-4a5283efe263",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "TcbdbxzebK9gSKPI",
          "name": "Google Gemini(PaLM) Api account 6"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const answer = $json[\"output\"];\nconst now = Math.floor(Date.now() / 1000);\n\nreturn [{\n  json: {\n    id: \"chatcmpl-\" + now,\n    object: \"chat.completion\",\n    created: now,\n    model: \"Áü•Ë≠òÊ©üÂô®‰∫∫\",\n    stream: false,\n    choices: [\n      {\n        index: 0,\n        message: {\n          role: \"assistant\",\n          content: $input.first().json.output.answer\n        },\n        finish_reason: \"stop\"\n      }\n    ],\n    usage: {\n      prompt_tokens: 50,\n      completion_tokens: 100,\n      total_tokens: 150\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2272,
        784
      ],
      "id": "4ca5f077-8624-4afd-a656-f594fd84859d",
      "name": "ÂõûÊáâÊ†ºÂºè"
    },
    {
      "parameters": {
        "content": "ÂÆöÊôÇÊãâÂèñnotionËΩâÂêëÈáè",
        "height": 320,
        "width": 2720
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        128,
        1408
      ],
      "id": "7e943351-3ab0-4b7f-9d67-5744e02d5208",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "Ê©üÂô®‰∫∫ÂïèÁ≠îÂÖ•Âè£",
        "height": 256,
        "width": 656,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        96,
        384
      ],
      "id": "f855ecc1-fc39-4744-b680-9c060f5a5f68",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "Ê©üÂô®‰∫∫Êü•Ë©¢Ê®°Âûã",
        "height": 256,
        "width": 656
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        96,
        64
      ],
      "id": "ce71d33b-b30b-4e14-9acd-ed62772bfca9",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "Êü•‰∏çÂà∞Ë≥áÊñôÊôÇÁöÑÂõûÂ†±+ÂõûÊáâ",
        "height": 400,
        "width": 912,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1984,
        256
      ],
      "id": "9377b242-80b6-472b-a2ac-a2a8cd8c61c2",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "Êèê‰æõÊ©üÂô®‰∫∫È°çÂ§ñË≥áË®ä",
        "height": 496,
        "width": 288
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        960,
        96
      ],
      "id": "a931e45a-f01e-40e4-9b6d-5db3064c7770",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "jsCode": "// ÂèñÂæóÁï∂ÂâçÁöÑ chat Ëº∏ÂÖ•\nconst currentInput = $input.first().json;\nconst chatInput = currentInput.chatInput || '';\nconst sessionId = currentInput.sessionId || '';\n\n// ÂòóË©¶ÂèñÂæóÂ∞çË©±Ê≠∑Âè≤ (Â¶ÇÊûúÊúâÊé• Memory ÁØÄÈªû)\nlet chatHistory = [];\ntry {\n  // Â¶ÇÊûú‰Ω†ÊúâÊé• Window Buffer Memory ÊàñÂÖ∂‰ªñ Memory ÁØÄÈªû,ÊîπÊàêÂ∞çÊáâÁöÑÁØÄÈªûÂêçÁ®±\n  chatHistory = $('Window Buffer Memory').all();\n} catch (e) {\n  // Ê≤íÊúâ Memory ÁØÄÈªû‰πüÊ≤íÈóú‰øÇ\n  console.log('Ê≤íÊúâÊâæÂà∞ Memory ÁØÄÈªû,‰ΩøÁî®Á©∫Ê≠∑Âè≤');\n}\n\nlet systemPrompt = '';\nconst userAssistantPairs = [];\nlet lastUserMessage = chatInput;\nlet tempPair = [];\nconst allMessages = [];\n\n// ËôïÁêÜÊ≠∑Âè≤Ë®äÊÅØ\nif (chatHistory && chatHistory.length > 0) {\n  for (const item of chatHistory) {\n    const message = item.json;\n    \n    // Memory ÁØÄÈªûÁöÑÊ†ºÂºèÂèØËÉΩÊòØ type: 'human'/'ai' Êàñ role: 'user'/'assistant'\n    const role = message.type === 'human' ? 'user' \n                : message.type === 'ai' ? 'assistant' \n                : message.role || 'user';\n    const content = message.text || message.content || message.message || '';\n    \n    if (!content) continue;\n    \n    allMessages.push({ role, content });\n    \n    if (role === 'system' && !systemPrompt) {\n      systemPrompt = content;\n      continue;\n    }\n    \n    if (role === 'user') {\n      if (tempPair.length > 0) {\n        userAssistantPairs.push(tempPair);\n      }\n      tempPair = [`‰ΩøÁî®ËÄÖ:${content}`];\n    } else if (role === 'assistant') {\n      tempPair.push(`AI:${content}`);\n      userAssistantPairs.push(tempPair);\n      tempPair = [];\n    }\n  }\n}\n\n// Âä†ÂÖ•Áï∂Ââç‰ΩøÁî®ËÄÖË®äÊÅØ\nif (lastUserMessage) {\n  allMessages.push({ role: 'user', content: lastUserMessage });\n  \n  // Â¶ÇÊûúÂâçÈù¢ÊúâÊú™ÂÆåÊàêÁöÑ pair,ÂÖàÂ≠òËµ∑‰æÜ\n  if (tempPair.length > 0) {\n    userAssistantPairs.push(tempPair);\n  }\n  // Âä†ÂÖ•Áï∂Ââç‰ΩøÁî®ËÄÖË®äÊÅØ\n  userAssistantPairs.push([`‰ΩøÁî®ËÄÖ:${lastUserMessage}`]);\n}\n\n// Âè™ÂèñÊúÄËøë 5 ÁµÑ\nconst last5Pairs = userAssistantPairs.slice(-5);\nconst dialogue = last5Pairs.flat().join('\\n');\n\n// Ëß£ÊûêË´ãÊ±ÇÁõÆÁöÑ\nlet ReqPurpose = 'query';\nif (lastUserMessage.trim().startsWith('###')) {\n  if (lastUserMessage.includes('Generate a concise, 3-5 word title')) {\n    ReqPurpose = 'title';\n  } else if (lastUserMessage.includes('Generate 1-3 broad tags')) {\n    ReqPurpose = 'tags';\n  } else if (\n    lastUserMessage.includes('Suggest 3-5 relevant follow-up questions') ||\n    lastUserMessage.includes('\"follow_ups\"')\n  ) {\n    ReqPurpose = 'follow_ups';\n  }\n}\n\n// Ëº∏Âá∫ÁµêÊûú\nreturn {\n  json: {\n    sessionId,           // ‰øùÁïô sessionId Áµ¶ÂæåÁ∫åÁØÄÈªû‰ΩøÁî®\n    systemPrompt,\n    dialogue,\n    lastUserMessage,\n    allMessages,\n    ReqPurpose,\n    chatInput            // ‰øùÁïôÂéüÂßã chatInput\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        768
      ],
      "id": "0a78b8c0-89ea-4565-aa44-288e5ddb0f28",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "public": true,
        "options": {
          "responseMode": "responseNodes"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        176,
        768
      ],
      "id": "012f2202-819c-488c-9cfa-fd5f9b749cf4",
      "name": "When chat message received",
      "webhookId": "34fc65d2-1849-44b5-92d5-93bfffdaa397"
    },
    {
      "parameters": {
        "message": "={{$node[\"AI Agent3\"].json[\"output\"]}}",
        "waitUserReply": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        2672,
        304
      ],
      "id": "516b2bf1-2ffe-4566-8bf1-017fe439e010",
      "name": "Respond to Chat"
    },
    {
      "parameters": {
        "message": "={{ $json.choices[0].message.content }}",
        "waitUserReply": false,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chat",
      "typeVersion": 1,
      "position": [
        2560,
        784
      ],
      "id": "f03e6273-73d5-4e51-9a82-c91bf2a3e184",
      "name": "Respond to Chat1"
    },
    {
      "parameters": {
        "content": "Ê©üÂô®‰∫∫",
        "height": 672,
        "width": 1536,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "id": "684dac65-1096-46da-9e84-0490243aabef",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "$node[\"Webhook completions\"].json[\"headers\"][\"x-openwebui-chat-id\"]"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        800,
        976
      ],
      "id": "4f880417-0e34-4de8-88db-b862d1d21d6a",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "query"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        2336,
        512
      ],
      "id": "313b4f27-2421-4f6d-af5e-a1b3e211d84b",
      "name": "Simple Memory1"
    }
  ],
  "connections": {
    "Webhook completions": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        []
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ÂõûÊáâÊ†ºÂºè",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent3": {
      "main": [
        [
          {
            "node": "Respond to Chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WriteNotionQA": {
      "ai_tool": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "AI Agent",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Res Title",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Res Tags",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Res Follow_ups",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook model": {
      "main": [
        [
          {
            "node": "create data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "create data": {
      "main": [
        [
          {
            "node": "Response Webhook model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Notion Page",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replace Me": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion DB": {
      "main": [
        [
          {
            "node": "Êï¥ÁêÜÊâπÊ¨°È†ÅÈù¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Notion Page": {
      "main": [
        [
          {
            "node": "Êï¥ÁêÜÂñÆ‰∏ÄÈ†ÅÈù¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Qdrant Vector Store": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SearchQADatabase": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings Google Gemini1": {
      "ai_embedding": [
        [
          {
            "node": "Qdrant Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Êï¥ÁêÜÂñÆ‰∏ÄÈ†ÅÈù¢": {
      "main": [
        [
          {
            "node": "HTTP Request ÂêëÈáèË®àÁÆó",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Êï¥ÁêÜÊâπÊ¨°È†ÅÈù¢": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ËΩâÊàêÂÑ≤Â≠òÊ†ºÂºè": {
      "main": [
        [
          {
            "node": "HTTP Request ÂÑ≤Â≠òÂêëÈáè",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request ÂêëÈáèË®àÁÆó": {
      "main": [
        [
          {
            "node": "ËΩâÊàêÂÑ≤Â≠òÊ†ºÂºè",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request ÂÑ≤Â≠òÂêëÈáè": {
      "main": [
        [
          {
            "node": "Replace Me",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule": {
      "main": [
        [
          {
            "node": "Notion DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "ÂõûÊáâÊ†ºÂºè": {
      "main": [
        [
          {
            "node": "Respond to Chat1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When chat message received": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "ed826c46-13a1-4734-ac6f-e96607b8f60d",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-11-06T05:49:20.472Z",
      "updatedAt": "2025-11-06T05:49:20.472Z",
      "role": "workflow:owner",
      "workflowId": "QqBn46QhoeZ9flPg",
      "projectId": "iZydbwsMPJYYjvth",
      "project": {
        "createdAt": "2025-09-16T02:39:54.633Z",
        "updatedAt": "2025-09-16T02:43:19.908Z",
        "id": "iZydbwsMPJYYjvth",
        "name": "common web <web@wanin.tw>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-16T02:39:54.639Z",
            "updatedAt": "2025-09-16T02:39:54.639Z",
            "userId": "55f25be3-69cb-4a61-849e-09b3e6328043",
            "projectId": "iZydbwsMPJYYjvth",
            "user": {
              "createdAt": "2025-09-16T02:39:54.628Z",
              "updatedAt": "2025-11-06T01:55:21.000Z",
              "id": "55f25be3-69cb-4a61-849e-09b3e6328043",
              "email": "web@wanin.tw",
              "firstName": "common",
              "lastName": "web",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-16T02:43:24.324Z",
                "personalization_survey_n8n_version": "1.108.1"
              },
              "settings": {
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "XN79dmNc8yPVm6XU",
                "userActivated": true,
                "userActivatedAt": 1758096117396,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1761544952978
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-11-05",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}